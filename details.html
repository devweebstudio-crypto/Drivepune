<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>DrivePune — Car Details</title>
<link rel="icon" href="https://i.ibb.co/LX093jkB/logo.png" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
  /* ---------------- Reset & Base ---------------- */
  :root {
    --primary: #2563eb;
    --primary-dark: #1d4ed8;
    --primary-light: #3b82f6;
    --text-dark: #1e293b;
    --text-medium: #475569;
    --text-light: #64748b;
    --bg-light: #f8fafc;
    --bg-white: #ffffff;
    --border: #e2e8f0;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    --radius: 12px;
    --radius-sm: 8px;
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
  }

  html, body {
    height: 100%;
  }

  body {
    background: var(--bg-light);
    color: var(--text-dark);
    -webkit-font-smoothing: antialiased;
    line-height: 1.6;
  }

  a {
    color: inherit;
    text-decoration: none;
  }

  .wrap {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 16px;
  }

  /* ---------------- Minimal Header ---------------- */
  .brand-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 130;
    background: var(--bg-white);
    color: var(--text-dark);
    padding: 16px 0;
    box-shadow: var(--shadow);
    border-bottom: 1px solid var(--border);
  }

  .brand-inner {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
  }

  .brand-title {
    font-weight: 800;
    font-size: 24px;
    letter-spacing: 0.2px;
    background: linear-gradient(90deg, var(--primary), var(--primary-dark));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .back-btn {
    background: var(--primary);
    color: white;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: var(--shadow);
  }

  .back-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
  }

  /* ---------------- Search Panel ---------------- */
  .search-panel {
    position: fixed;
    top: 76px;
    left: 0;
    right: 0;
    z-index: 125;
    background: var(--bg-white);
    padding: 20px 16px;
    box-shadow: var(--shadow);
    border-bottom: 1px solid var(--border);
    display: none;
  }

  .search-panel.active {
    display: block;
  }

  .search-form {
    max-width: 800px;
    margin: 0 auto;
    display: flex;
    gap: 12px;
    align-items: center;
  }

  .input-group {
    position: relative;
    flex: 1;
  }

  .input-group .icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-light);
    font-size: 16px;
    pointer-events: none;
  }

  .input-group input {
    width: 100%;
    padding: 14px 16px 14px 44px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    font-size: 15px;
    transition: all 0.2s ease;
    background: var(--bg-light);
  }

  .input-group input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }

  .search-controls {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  .search-controls select {
    padding: 12px 14px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    min-width: 140px;
    font-size: 14px;
    background: var(--bg-light);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .search-controls select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }

  .search-btn {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    padding: 12px 20px;
    border-radius: var(--radius);
    border: 0;
    cursor: pointer;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
    box-shadow: var(--shadow);
  }

  .search-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  /* ensure page content is visible below fixed header */
  .page-spacer {
    height: 76px;
  }

  /* ---------------- Content (details card) ---------------- */
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 16px;
  }

  .breadcrumb {
    padding: 16px 0;
    color: var(--text-medium);
    font-size: 14px;
  }

  .breadcrumb a {
    color: var(--primary);
    font-weight: 600;
  }

  .car-details-section {
    padding: 0 0 40px;
  }

  .car-details-container {
    display: flex;
    flex-wrap: wrap;
    gap: 24px;
    align-items: flex-start;
  }

  .car-images {
    flex: 1;
    min-width: 300px;
  }

  .main-image {
    width: 100%;
    height: 420px;
    object-fit: cover;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
  }

  .thumbnail-container {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    margin-top: 12px;
    padding: 4px 0;
  }

  .thumbnail {
    width: 110px;
    height: 70px;
    object-fit: cover;
    border-radius: var(--radius-sm);
    cursor: pointer;
    opacity: 0.75;
    transition: all 0.2s ease;
    border: 2px solid transparent;
  }

  .thumbnail.active, .thumbnail:hover {
    opacity: 1;
    transform: translateY(-2px);
    border-color: var(--primary);
  }

  .car-info {
    flex: 1;
    min-width: 300px;
    background: var(--bg-white);
    padding: 24px;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
  }

  .car-title {
    font-size: 24px;
    font-weight: 800;
    color: var(--text-dark);
    margin-bottom: 8px;
  }

  .car-price {
    font-size: 22px;
    color: var(--primary);
    font-weight: 900;
    margin-bottom: 16px;
  }

  .car-specs {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 20px;
  }

  .spec-item {
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--bg-light);
    padding: 14px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
  }

  .spec-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--primary);
    color: white;
    font-size: 16px;
  }

  .spec-label {
    font-size: 13px;
    color: var(--text-light);
  }

  .spec-value {
    font-size: 15px;
    color: var(--text-dark);
    font-weight: 700;
  }

  .features-list {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 16px;
  }

  .feature-tag {
    background: var(--bg-light);
    padding: 8px 14px;
    border-radius: 50px;
    font-weight: 700;
    color: var(--text-dark);
    font-size: 13px;
    border: 1px solid var(--border);
  }

  .action-buttons {
    display: flex;
    gap: 12px;
    margin-top: 20px;
  }

  .btn {
    padding: 14px 18px;
    border-radius: var(--radius);
    border: 0;
    cursor: pointer;
    font-weight: 700;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    justify-content: center;
    transition: all 0.2s ease;
    font-size: 15px;
    box-shadow: var(--shadow);
  }

  .btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .btn-whatsapp {
    background: linear-gradient(135deg, #25D366, #128C7E);
    color: white;
  }

  .btn-call {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
  }

  .btn-book {
    background: linear-gradient(135deg, #f59e0b, #e67e22);
    color: white;
    flex: 1;
  }

  .rental-terms {
    margin-top: 24px;
    background: var(--bg-white);
    padding: 24px;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
  }

  .terms-title {
    font-size: 18px;
    font-weight: 800;
    margin-bottom: 16px;
    color: var(--text-dark);
  }

  .terms-list {
    list-style: none;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 12px;
  }

  .terms-list li {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
  }

  .terms-list li:last-child {
    border-bottom: none;
  }

  .terms-list span:first-child {
    color: var(--text-medium);
    font-weight: 600;
  }

  .terms-list span:last-child {
    color: var(--text-dark);
    font-weight: 700;
  }

  /* loading */
  .loading {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-light);
    font-weight: 700;
    font-size: 18px;
  }

  /* footer */
  footer {
    margin-top: 40px;
    padding: 24px 16px;
    text-align: center;
    color: var(--text-medium);
    font-size: 14px;
    border-top: 1px solid var(--border);
  }

  /* ---------------- Responsive Design ---------------- */
  @media (max-width: 1024px) {
    .car-details-container {
      gap: 20px;
    }
  }

  @media (max-width: 768px) {
    .brand-title {
      font-size: 20px;
    }
    
    .search-form {
      flex-direction: column;
      align-items: stretch;
    }
    
    .search-controls {
      display: flex;
      flex-wrap: wrap;
    }
    
    .search-controls select {
      flex: 1;
      min-width: 120px;
    }
    
    .main-image {
      height: 320px;
    }
    
    .thumbnail {
      width: 90px;
      height: 60px;
    }
    
    .car-info {
      padding: 20px;
    }
    
    .action-buttons {
      flex-direction: column;
    }
    
    .btn {
      width: 100%;
    }
  }

  @media (max-width: 640px) {
    .car-title {
      font-size: 20px;
    }
    
    .car-price {
      font-size: 20px;
    }
    
    .car-specs {
      grid-template-columns: 1fr;
    }
    
    .terms-list {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>

  <!-- MINIMAL HEADER -->
  <div class="brand-header" id="brandHeader" role="banner">
    <div class="brand-inner">
      <div class="brand-title">DrivePune</div>
      <a href="index.html" class="back-btn" aria-label="Back to home">
        <i class="fas fa-arrow-left"></i>
      </a>
    </div>
  </div>

  <!-- SEARCH PANEL (hidden by default) -->
  <div class="search-panel" id="searchPanel" role="search" aria-label="Search cars">
    <div class="search-form">
      <div class="input-group">
        <span class="icon"><i class="fas fa-search"></i></span>
        <input id="searchInput" placeholder="Search cars, model or feature (e.g., Swift, Innova, diesel)" />
      </div>

      <div class="search-controls">
        <select id="fuelTypeFilter" aria-label="Fuel type">
          <option value="">Fuel: All</option>
          <option value="petrol">Petrol</option>
          <option value="diesel">Diesel</option>
          <option value="cng">CNG</option>
          <option value="electric">Electric</option>
        </select>

        <select id="carTypeFilter" aria-label="Car type">
          <option value="">Type: All</option>
          <option value="hatchback">Hatchback</option>
          <option value="sedan">Sedan</option>
          <option value="suv">SUV</option>
          <option value="mpv">MPV</option>
        </select>

        <button id="searchButton" class="search-btn"><i class="fas fa-search"></i> Search</button>
      </div>
    </div>
  </div>

  <!-- spacer so content not hidden underneath fixed header -->
  <div class="page-spacer" aria-hidden="true"></div>

  <!-- Breadcrumb -->
  <div class="container breadcrumb">
    <a href="index.html">Home</a> &nbsp;›&nbsp; <a href="index.html">Available Cars</a> &nbsp;›&nbsp; <span id="breadcrumbCarName">Car Details</span>
  </div>

  <!-- Car Details Section -->
  <section class="car-details-section">
    <div class="container" id="carDetailsContainer">
      <div class="loading">Loading car details...</div>
    </div>
  </section>

  <footer>© DrivePune — Pune • +91 95118 64107</footer>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    // ---------------- Firebase config (same as site) ----------------
    const firebaseConfig = {
      apiKey: "AIzaSyCqDu2iOLaqZP-pxr4gxuuKuwwhzsd5E4s",
      authDomain: "car-rental-website-43a4f.firebaseapp.com",
      projectId: "car-rental-website-43a4f",
      storageBucket: "car-rental-website-43a4f.firebasestorage.app",
      messagingSenderId: "850074386251",
      appId: "1:850074386251:web:dc3e8f3f476a3cfab072ce"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const carsCollection = db.collection('cars');

    // ---------------- DOM refs ----------------
    const carDetailsContainer = document.getElementById('carDetailsContainer');
    const breadcrumbCarName = document.getElementById('breadcrumbCarName');
    const searchInput = document.getElementById('searchInput');
    const fuelTypeFilter = document.getElementById('fuelTypeFilter');
    const carTypeFilter = document.getElementById('carTypeFilter');
    const searchButton = document.getElementById('searchButton');
    const searchPanel = document.getElementById('searchPanel');

    const WHATSAPP_PHONE = '919511864107';
    const CALL_PHONE = '+919511864107';

    // ---------------- Utility ----------------
    function escapeForJS(s){ return (''+s).replace(/'/g,"\\'").replace(/"/g,'\\"'); }

    // ---------------- Get car id from URL ----------------
    function getCarIdFromURL(){
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('id');
    }

    // ---------------- Render helpers ----------------
    function changeImage(thumbnail){
      document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
      thumbnail.classList.add('active');
      document.getElementById('mainImage').src = thumbnail.src;
    }

    function createCarDetailsHTML(car){
      breadcrumbCarName.textContent = car.name || 'Car Details';

      // thumbnails
      let thumbnailsHTML = '';
      if (car.images && car.images.length){
        car.images.forEach((imgUrl, idx) => {
          const active = idx === 0 ? 'active' : '';
          thumbnailsHTML += `<img src="${imgUrl}" class="thumbnail ${active}" alt="${car.name}" onclick="changeImage(this)">`;
        });
      } else {
        thumbnailsHTML = '<p>No images available</p>';
      }

      // features - keep same static list but you can replace if `car.features` exists
      const featuresList = (car.features && car.features.length) ? car.features : ['Air Conditioning','Bluetooth','GPS Navigation','Backup Camera','Power Windows','ABS','Airbags'];
      const featuresHTML = featuresList.map(f => `<span class="feature-tag">${f}</span>`).join('');

      // build details html
      return `
        <div class="car-details-container">
          <div class="car-images">
            <img id="mainImage" src="${(car.images && car.images[0]) || 'https://images.unsplash.com/photo-1549317661-bd32c8ce0db2?auto=format&fit=crop&w=1200&q=80'}" alt="${car.name}" class="main-image">
            <div class="thumbnail-container">${thumbnailsHTML}</div>
          </div>

          <div class="car-info">
            <h1 class="car-title">${car.name || 'Unknown'} ${car.year ? car.year : ''}</h1>
            <div class="car-price">₹${car.dailyRate || '0'} <small>/day</small></div>

            <div class="car-specs">
              <div class="spec-item">
                <div class="spec-icon"><i class="fas fa-gas-pump"></i></div>
                <div>
                  <div class="spec-label">Fuel</div>
                  <div class="spec-value">${car.fuelType || 'N/A'}</div>
                </div>
              </div>
              <div class="spec-item">
                <div class="spec-icon"><i class="fas fa-cogs"></i></div>
                <div>
                  <div class="spec-label">Transmission</div>
                  <div class="spec-value">${car.transmission || 'N/A'}</div>
                </div>
              </div>
              <div class="spec-item">
                <div class="spec-icon"><i class="fas fa-user-friends"></i></div>
                <div>
                  <div class="spec-label">Seats</div>
                  <div class="spec-value">${car.seats || 'N/A'}</div>
                </div>
              </div>
              <div class="spec-item">
                <div class="spec-icon"><i class="fas fa-tachometer-alt"></i></div>
                <div>
                  <div class="spec-label">Mileage</div>
                  <div class="spec-value">${car.mileage ? car.mileage + ' km' : 'N/A'}</div>
                </div>
              </div>
              <div class="spec-item">
                <div class="spec-icon"><i class="fas fa-calendar-alt"></i></div>
                <div>
                  <div class="spec-label">Year</div>
                  <div class="spec-value">${car.year || 'N/A'}</div>
                </div>
              </div>
              <div class="spec-item">
                <div class="spec-icon"><i class="fas fa-money-bill-wave"></i></div>
                <div>
                  <div class="spec-label">Deposit</div>
                  <div class="spec-value">₹${car.deposit || '0'}</div>
                </div>
              </div>
            </div>

            <div class="car-features">
              <h3 style="margin-bottom: 12px; color: var(--text-dark);">Car Features</h3>
              <div class="features-list">${featuresHTML}</div>
            </div>

            <div class="action-buttons">
              <button class="btn btn-whatsapp" onclick="contactViaWhatsApp('${escapeForJS(car.name || '')}')">
                <i class="fab fa-whatsapp"></i> WhatsApp
              </button>
              <button class="btn btn-call" onclick="callNow()">
                <i class="fas fa-phone"></i> Call Now
              </button>
              <button class="btn btn-book" onclick="bookCar('${escapeForJS(car.name || '')}')">
                <i class="fas fa-calendar-check"></i> Book Now
              </button>
            </div>
          </div>
        </div>

        <div class="rental-terms">
          <h2 class="terms-title">Rental Terms & Conditions</h2>
          <ul class="terms-list">
            <li><span>Security Deposit</span><span>₹${car.deposit || '200'} (refundable)</span></li>
            <li><span>Minimum Rental Period</span><span>1 day</span></li>
            <li><span>Maximum Rental Period</span><span>30 days</span></li>
            <li><span>Free Mileage</span><span>100 km/day</span></li>
            <li><span>Additional Mileage Charge</span><span>₹0.25/km</span></li>
            <li><span>Fuel Policy</span><span>Same as received</span></li>
            <li><span>Insurance</span><span>Comprehensive coverage included</span></li>
            <li><span>Driver Age</span><span>21 years minimum</span></li>
          </ul>
        </div>
      `;
    }

    // ---------------- Contact handlers ----------------
    function contactViaWhatsApp(carName){
      const message = `Hi, I'm interested in renting the ${carName}. Please share availability.`;
      window.open(`https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent(message)}`, '_blank');
    }
    
    function callNow(){ 
      window.location.href = 'tel:' + CALL_PHONE; 
    }
    
    function bookCar(carName){
      const message = `Hi, I want to book the ${carName}. Please confirm availability and process.`;
      window.open(`https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent(message)}`, '_blank');
    }

    // ---------------- Search behavior: redirect to index with params ----------------
    function applySearchRedirect(){
      const q = (searchInput.value || '').trim();
      const fuel = fuelTypeFilter.value || '';
      const type = carTypeFilter.value || '';
      
      // simple redirect to index with query params so the index can pick it up
      const url = new URL(window.location.origin + '/index.html');
      if (q) url.searchParams.set('q', q);
      if (fuel) url.searchParams.set('fuel', fuel);
      if (type) url.searchParams.set('type', type);
      window.location.href = url.toString();
    }

    searchButton.addEventListener('click', applySearchRedirect);
    searchInput.addEventListener('keyup', (e)=>{ if (e.key === 'Enter') applySearchRedirect(); });

    // ---------------- Realtime listener for this car doc ----------------
    let docUnsubscribe = null;
    function watchCarDocRealtime(carId){
      if (!carId) return;
      // detach previous
      if (docUnsubscribe) docUnsubscribe();

      const ref = carsCollection.doc(carId);
      docUnsubscribe = ref.onSnapshot(doc => {
        if (!doc.exists){
          carDetailsContainer.innerHTML = '<div class="loading">Car not found. <a href="index.html">Return to home</a></div>';
          return;
        }
        const car = doc.data();
        carDetailsContainer.innerHTML = createCarDetailsHTML(car);
      }, err => {
        console.error('car doc snapshot error', err);
        // fallback to one-time get
        ref.get().then(d => {
          if (!d.exists) carDetailsContainer.innerHTML = '<div class="loading">Car not found. <a href="index.html">Return to home</a></div>';
          else { carDetailsContainer.innerHTML = createCarDetailsHTML(d.data()); }
        }).catch(e => { carDetailsContainer.innerHTML = '<div class="loading">Error loading car. Try again later.</div>'; });
      });
    }

    // ---------------- Init ----------------
    document.addEventListener('DOMContentLoaded', () => {
      const carId = getCarIdFromURL();
      if (!carId){
        carDetailsContainer.innerHTML = '<div class="loading">Car not found. <a href="index.html">Return to homepage</a></div>';
        return;
      }
      watchCarDocRealtime(carId);
    });

    // Expose changeImage globally so thumbnail onclick works
    window.changeImage = changeImage;
  </script>
</body>
</html>
